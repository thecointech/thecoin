{
  "openapi" : "3.0.1",
  "info" : {
    "title" : "THE TapCap supply",
    "description" : "The interace for TapCap between buyers & sellers.",
    "contact" : {
      "email" : "stephen.taylor.dev@gmail.com"
    },
    "license" : {
      "name" : "Apache 2.0",
      "url" : "http://www.apache.org/licenses/LICENSE-2.0.html"
    },
    "version" : "0.1.0"
  },
  "servers" : [ {
    "url" : "https://thecoincad.tplinkdns.com:9361/"
  } ],
  "tags" : [ {
    "name" : "Transaction",
    "description" : "These API's can be called by a client to affect a TapCap purchase transaction, exchanging THE with the supplier to complete fiat tap transactions"
  } ],
  "paths" : {
    "/static" : {
      "post" : {
        "tags" : [ "Transaction" ],
        "summary" : "Get the list of static responses to cache for terminal queries",
        "operationId" : "getStatic",
        "requestBody" : {
          "description" : "Static data request",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/SignedMessage"
              }
            }
          },
          "required" : true
        },
        "responses" : {
          "200" : {
            "description" : "Static response cache",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/StaticResponses"
                }
              }
            }
          },
          "405" : {
            "description" : "Invalid input",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorMessage"
                }
              }
            }
          }
        }
      }
    },
    "/static/single" : {
      "post" : {
        "tags" : [ "Transaction" ],
        "summary" : "Query the server for a single message if it is unknown",
        "operationId" : "getStaticSingle",
        "requestBody" : {
          "description" : "Static data request",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/QueryWithHistory"
              }
            }
          },
          "required" : true
        },
        "responses" : {
          "200" : {
            "description" : "Static response cache",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/StaticResponse"
                }
              }
            }
          },
          "405" : {
            "description" : "Invalid input",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorMessage"
                }
              }
            }
          }
        }
      }
    },
    "/tap" : {
      "post" : {
        "tags" : [ "Transaction" ],
        "summary" : "Request TapCap transaction",
        "description" : "This is sent in response to a terminal request.  The supplier is expected to return a valid certificate to pass to the terminal",
        "operationId" : "requestTapCap",
        "requestBody" : {
          "description" : "TapCap exchange request",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/SignedMessage"
              }
            }
          },
          "required" : true
        },
        "responses" : {
          "200" : {
            "description" : "Info required to complete the transaction, including coin charged, and the data to be returned to the teriminal",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/SignedMessage"
                }
              }
            }
          },
          "405" : {
            "description" : "Invalid input",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ErrorMessage"
                }
              }
            }
          }
        }
      }
    },
    "/contest" : {
      "post" : {
        "tags" : [ "Transaction" ],
        "summary" : "Notify of a contested transaction",
        "description" : "Notify supplier that the client will contest the passed transaction.  This is not necessary, a supplier should auotomatically undo any incompelete transactions, but it is a courtesy to the supplier",
        "operationId" : "contestTapCap",
        "requestBody" : {
          "description" : "TapCap exchange request",
          "content" : {
            "application/json" : {
              "schema" : {
                "$ref" : "#/components/schemas/SignedTapcapContest"
              }
            }
          },
          "required" : true
        },
        "responses" : {
          "200" : {
            "description" : "Server status",
            "content" : {
              "application/json" : {
                "schema" : {
                  "$ref" : "#/components/schemas/ContestResponse"
                }
              }
            }
          },
          "405" : {
            "description" : "Invalid input",
            "content" : { }
          }
        }
      }
    }
  },
  "components" : {
    "schemas" : {
      "StaticResponse" : {
        "required" : [ "response" ],
        "type" : "object",
        "properties" : {
          "response" : {
            "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
            "type" : "string",
            "format" : "byte"
          }
        },
        "example" : {
          "response" : "response"
        }
      },
      "FXRate" : {
        "required" : [ "buy", "fxRate", "sell", "validFrom", "validTill" ],
        "type" : "object",
        "properties" : {
          "target" : {
            "type" : "integer"
          },
          "buy" : {
            "type" : "number",
            "format" : "double"
          },
          "sell" : {
            "type" : "number",
            "format" : "double"
          },
          "fxRate" : {
            "type" : "number",
            "format" : "double"
          },
          "validFrom" : {
            "type" : "integer",
            "format" : "int64"
          },
          "validTill" : {
            "type" : "integer",
            "format" : "int64"
          }
        }
      },
      "TapCapToken" : {
        "required" : [ "availableBalance", "clientAccount", "nonce", "timestamp" ],
        "type" : "object",
        "properties" : {
          "clientAccount" : {
            "type" : "string"
          },
          "availableBalance" : {
            "type" : "integer",
            "format" : "int64"
          },
          "nonce" : {
            "type" : "integer"
          },
          "timestamp" : {
            "type" : "integer",
            "format" : "int64"
          }
        }
      },
      "TapCapClientRequest" : {
        "required" : [ "cryptoData", "gpoData", "timestamp", "token" ],
        "type" : "object",
        "properties" : {
          "timestamp" : {
            "type" : "integer",
            "format" : "int64"
          },
          "gpoData" : {
            "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
            "type" : "string",
            "format" : "byte"
          },
          "cryptoData" : {
            "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
            "type" : "string",
            "format" : "byte"
          },
          "token" : {
            "$ref" : "#/components/schemas/SignedMessage"
          }
        }
      },
      "TapCapBrokerPurchase" : {
        "required" : [ "FxRate", "coinCharge", "cryptoCertificate", "signedRequest" ],
        "type" : "object",
        "properties" : {
          "signedRequest" : {
            "$ref" : "#/components/schemas/SignedMessage"
          },
          "FxRate" : {
            "$ref" : "#/components/schemas/FXRate"
          },
          "coinCharge" : {
            "type" : "integer",
            "format" : "int64"
          },
          "cryptoCertificate" : {
            "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
            "type" : "string",
            "format" : "byte"
          }
        }
      },
      "SignedTapcapContest" : {
        "required" : [ "fiatAmount", "pdol", "signature", "timestamp", "token" ],
        "type" : "object",
        "properties" : {
          "timestamp" : {
            "type" : "integer",
            "format" : "int64"
          },
          "fiatAmount" : {
            "type" : "number",
            "format" : "double"
          },
          "pdol" : {
            "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
            "type" : "string",
            "format" : "byte"
          },
          "token" : {
            "$ref" : "#/components/schemas/SignedMessage"
          },
          "signature" : {
            "type" : "string"
          }
        },
        "example" : {
          "pdol" : "pdol",
          "signature" : "signature",
          "fiatAmount" : 6.02745618307040320615897144307382404804229736328125,
          "timestamp" : 0,
          "token" : {
            "signature" : "signature",
            "message" : "message"
          }
        }
      },
      "SignedMessage" : {
        "required" : [ "message", "signature" ],
        "type" : "object",
        "properties" : {
          "message" : {
            "type" : "string"
          },
          "signature" : {
            "type" : "string"
          }
        },
        "example" : {
          "signature" : "signature",
          "message" : "message"
        }
      },
      "QueryWithHistory" : {
        "required" : [ "queries", "query", "responses" ],
        "type" : "object",
        "properties" : {
          "query" : {
            "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
            "type" : "string",
            "format" : "byte"
          },
          "queries" : {
            "type" : "array",
            "items" : {
              "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
              "type" : "string",
              "format" : "byte"
            }
          },
          "responses" : {
            "type" : "array",
            "items" : {
              "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
              "type" : "string",
              "format" : "byte"
            }
          }
        },
        "example" : {
          "query" : "query",
          "responses" : [ "responses", "responses" ],
          "queries" : [ "queries", "queries" ]
        }
      },
      "ContestResponse" : {
        "type" : "object",
        "properties" : {
          "code" : {
            "type" : "integer",
            "format" : "int32"
          }
        },
        "example" : {
          "code" : 0
        }
      },
      "StaticResponses" : {
        "required" : [ "gpoPdol", "queries", "responseParentIndex", "responses" ],
        "type" : "object",
        "properties" : {
          "gpoPdol" : {
            "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
            "type" : "string",
            "format" : "byte"
          },
          "cryptoPdol" : {
            "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
            "type" : "string",
            "format" : "byte"
          },
          "queries" : {
            "type" : "array",
            "items" : {
              "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
              "type" : "string",
              "format" : "byte"
            }
          },
          "responses" : {
            "type" : "array",
            "items" : {
              "pattern" : "^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$",
              "type" : "string",
              "format" : "byte"
            }
          },
          "responseParentIndex" : {
            "type" : "array",
            "items" : {
              "type" : "integer"
            }
          }
        },
        "example" : {
          "responseParentIndex" : [ 0, 0 ],
          "gpoPdol" : "gpoPdol",
          "responses" : [ "responses", "responses" ],
          "queries" : [ "queries", "queries" ],
          "cryptoPdol" : "cryptoPdol"
        }
      },
      "ErrorMessage" : {
        "required" : [ "code", "id", "message" ],
        "type" : "object",
        "properties" : {
          "code" : {
            "type" : "integer"
          },
          "id" : {
            "type" : "string"
          },
          "message" : {
            "type" : "string"
          }
        }
      }
    }
  }
}
