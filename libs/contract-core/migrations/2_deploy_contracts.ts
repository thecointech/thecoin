import { MigrationStep } from './step';
import { getSigner } from '@thecointech/signers';
import { writeContractFile } from '@thecointech/contract-tools/migrations'

// It seems the types for deployProxy don't match the types
// generated by typechain.  We use require to strip the
// typing from OZ, as the function seems to work fine anyway
const { deployProxy } = require('@openzeppelin/truffle-upgrades');

const step: MigrationStep = (artifacts) =>
  async (deployer, network, _accounts) => {

    const contract = artifacts.require("TheCoin");

    const tcSigner = await getSigner('TheCoin');
    const tcAddr = await tcSigner.getAddress();
    const proxy = await deployProxy(contract, [tcAddr], { deployer });

    // Serialize our contract addresses
    writeContractFile(__dirname, 'src', network, proxy.address);
    writeContractFile(__dirname, 'build', network, proxy.address);
  }

module.exports = step
